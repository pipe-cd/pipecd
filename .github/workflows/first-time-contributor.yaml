name: First-time contributor welcome

on:
  pull_request_target:
    types: [opened]

permissions:
  pull-requests: write

jobs:
  welcome:
    runs-on: ubuntu-latest

    steps:
      - name: Welcome first-time contributor
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const prAuthor = context.payload.pull_request.user.login;
            const prNumber = context.payload.pull_request.number;

            // List PRs created by this user in this repo
            const { data: pulls } = await github.rest.pulls.list({
              owner,
              repo,
              state: "all",
              creator: prAuthor,
              per_page: 2,
            });

            // If more than one PR exists, this is not the first one
            if (pulls.length > 1) {
              console.log(`User ${prAuthor} is not a first-time contributor.`);
              return;
            }

            const body = `ðŸ‘‹ Hi @${prAuthor}, welcome to **PipeCD** and thanks for opening your first pull request!

Weâ€™re really happy to have you here Before your PR gets merged, please check a few important things:

---

###  DCO Sign-off (Required)
All commits must include a \`Signed-off-by\` line.

If you forgot, you can fix it like this:

For the last commit:
\`\`\`bash
git commit --amend --signoff
git push --force-with-lease
\`\`\`

For multiple commits:
\`\`\`bash
git rebase --signoff origin/master
git push --force-with-lease
\`\`\`

This is required by the Developer Certificate of Origin (DCO).
---
### Run checks locally
Before pushing updates, please run:
\`\`\`bash
make check
\`\`\`
This runs the same checks as CI and saves time for everyone.
---
If anything is unclear, feel free to ask in this PR or on Slack. Weâ€™re happy to help 

Thanks for contributing to PipeCD! 
`;

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: prNumber,
              body,
            });
